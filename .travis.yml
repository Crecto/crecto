language: crystal
script:
  - crystal spec -D $DB_TYPE
  - crystal tool format --check
services:
  - mysql
  - postgresql
addons:
  postgresql: "9.4"
  apt:
    sources:
      - travis-ci/sqlite3
    packages:
      - sqlite3
before_script:
  - mysql -e 'create database crecto_test'
  - mysql -Dcrecto_test < spec/migrations/mysql_migrations.sql
  - psql -c 'create database crecto_test;' -U postgres
  - psql $PG_URL < spec/migrations/pg_migrations.sql
  - sqlite3 ./crecto_test.db < spec/migrations/sqlite3_migrations.sql
  - cp ./spec/travis_${DB_TYPE}_repo.cr ./spec/repo.cr
env:
  matrix:
    - PG_URL=postgres://postgres@localhost:5432/crecto_test DB_TYPE=pg
    - MYSQL_URL=mysql://root@localhost/crecto_test DB_TYPE=mysql
    - SQLITE3_PATH=sqlite3://./crecto_test.db DB_TYPE=sqlite
